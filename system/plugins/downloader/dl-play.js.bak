const yts = require('yt-search');

module.exports = {
   command: "play",
   alias: ["playmusic"],
   category: ["downloader"],
   settings: {
      group: true
   },
   description: "Play Music ğŸµ",
   loading: true,
   async run(m, { text, sock }) {
      if (!text) return m.reply('âš ï¸ Masukkan judul lagunya terlebih dahulu!');

      let convert = await yts({ search: text, hl: 'id', gl: 'ID' });

      if (convert === 0) {
         return m.reply('âŒ Lagu yang Anda cari tidak ditemukan...');
      }
      let result = convert.all[0];
      let api = await fetch(`https://restapi.apibotwa.biz.id/api/ytmp3?url=${result.url}`);
      let ress = await api.json();
      let urlAudio = ress.data.response.link
      let DEVOLUTION = `âœ¨ğŸ¶ *[ PLAY - YOUTUBE ]* ğŸ¶âœ¨\n`;
      DEVOLUTION += `ğŸµ *Title*: ${result.title}\n`;
      DEVOLUTION += `ğŸ†” *ID*: ${result.videoId}\n`;
      DEVOLUTION += `â±ï¸ *Durasi*: ${result.timestamp}\n`;
      DEVOLUTION += `ğŸ“… *Uploaded*: ${result.ago}\n`;
      DEVOLUTION += `ğŸ“„ *Deskripsi*: ${result.description}\n`;
      DEVOLUTION += `ğŸ”— *URL*: ${result.url}\n`;
      DEVOLUTION += `âœ¨â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âœ¨\n\n`;
      DEVOLUTION += `âš ï¸ *Jika ingin video, reply dengan .mp4*`;

      await sock.sendMessage(m.cht, {
         text: DEVOLUTION,
         contextInfo: {
            forwardingScore: 999,
            isForwarded: true,
            externalAdReply: {
               title: result.title,
               mediaType: 1,
               previewType: 1,
               body: `â±ï¸ Durasi: ${result.timestamp} | ğŸ‘ï¸ View: ${result.views}`,
               thumbnailUrl: result.image,
               renderLargerThumbnail: true,
               mediaUrl: result.url,
               sourceUrl: result.url
            }
         }
      }, { quoted: m });

      try {
         await sock.sendMessage(m.cht, { 
            audio: { url: `${urlAudio}` }, 
            mimetype: 'audio/mpeg' 
         }, { quoted: m });
      } catch (e) {
         m.reply('âŒ Maaf, terjadi kesalahan...');
         console.error(e);
      }
   }
};